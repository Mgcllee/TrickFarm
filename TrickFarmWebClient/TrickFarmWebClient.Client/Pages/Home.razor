@page "/"
@inject IJSRuntime JS

<h3>고정 채팅 UI</h3>

<div class="chat-container">
    <div class="chat-messages" id="chatMessages">
        @foreach (var message in messages)
        {
            <div class="chat-message">@message</div>
        }
    </div>

    <div class="chat-input-bar">
        <input type="text" @bind="newMessage" @bind:event="oninput" @onkeydown="HandleKeyPress" placeholder="메시지를 입력하세요" class="chat-input" />
        <button @onclick="SendMessage" class="chat-send-btn">전송</button>
    </div>
</div>

<style>
    .chat-container {
    position: fixed;
    bottom: 0;
    left: 250px;
    width: calc(100% - 250px);
    display: flex;
    flex-direction: column;
    height: 80vh;
    }

    .chat-messages {
    flex: 1;
    overflow-y: auto;
    border: 1px solid #ccc;
    padding: 10px;
    background: white;
    }

    .chat-input-bar {
    display: flex;
    align-items: center;
    padding: 10px;
    background-color: #f8f9fa;
    border-top: 1px solid #ccc;
    }

    .chat-input {
    flex: 1;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    outline: none;
    }

    .chat-send-btn {
    margin-left: 10px;
    padding: 8px 12px;
    border: none;
    background-color: #007bff;
    color: white;
    cursor: pointer;
    border-radius: 4px;
    }

    .chat-send-btn:hover {
    background-color: #0056b3;
    }
</style>

@code {
    private List<string> messages = new();
    private string newMessage = "";
    private string UserMessage = "";

    protected override async Task OnInitializedAsync()
    {
        // SignalR 을 사용한 실시간 채팅 갱신 사용하기
    }

    private async Task SendMessage()
    {
        messages.Add(newMessage);
        await InvokeScrollToBottom();
    }

    private async Task HandleKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await SendMessage();
        }
    }

    private async Task InvokeScrollToBottom()
    {
        await JS.InvokeVoidAsync("eval", @"
            setTimeout(() => {
                var lastMessage = document.getElementById('lastMessage');
                if (lastMessage) {
                    lastMessage.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }
            }, 50);
        ");
    }
    
}